{"ast":null,"code":"import { decode as _decode } from '../decode.js';\nimport { Token, Type } from '../token.js';\nimport { decodeCodePointsArray } from '../byte-utils.js';\nimport { decodeErrPrefix } from '../common.js';\n\nclass Tokenizer {\n  constructor(data) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    this.pos = 0;\n    this.data = data;\n    this.options = options;\n    this.modeStack = ['value'];\n    this.lastToken = '';\n  }\n\n  done() {\n    return this.pos >= this.data.length;\n  }\n\n  ch() {\n    return this.data[this.pos];\n  }\n\n  currentMode() {\n    return this.modeStack[this.modeStack.length - 1];\n  }\n\n  skipWhitespace() {\n    let c = this.ch();\n\n    while (c === 32 || c === 9 || c === 13 || c === 10) {\n      c = this.data[++this.pos];\n    }\n  }\n\n  expect(str) {\n    if (this.data.length - this.pos < str.length) {\n      throw new Error(`${decodeErrPrefix} unexpected end of input at position ${this.pos}`);\n    }\n\n    for (let i = 0; i < str.length; i++) {\n      if (this.data[this.pos++] !== str[i]) {\n        throw new Error(`${decodeErrPrefix} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...str)}'`);\n      }\n    }\n  }\n\n  parseNumber() {\n    const startPos = this.pos;\n    let negative = false;\n    let float = false;\n\n    const swallow = chars => {\n      while (!this.done()) {\n        const ch = this.ch();\n\n        if (chars.includes(ch)) {\n          this.pos++;\n        } else {\n          break;\n        }\n      }\n    };\n\n    if (this.ch() === 45) {\n      negative = true;\n      this.pos++;\n    }\n\n    if (this.ch() === 48) {\n      this.pos++;\n\n      if (this.ch() === 46) {\n        this.pos++;\n        float = true;\n      } else {\n        return new Token(Type.uint, 0, this.pos - startPos);\n      }\n    }\n\n    swallow([48, 49, 50, 51, 52, 53, 54, 55, 56, 57]);\n\n    if (negative && this.pos === startPos + 1) {\n      throw new Error(`${decodeErrPrefix} unexpected token at position ${this.pos}`);\n    }\n\n    if (!this.done() && this.ch() === 46) {\n      if (float) {\n        throw new Error(`${decodeErrPrefix} unexpected token at position ${this.pos}`);\n      }\n\n      float = true;\n      this.pos++;\n      swallow([48, 49, 50, 51, 52, 53, 54, 55, 56, 57]);\n    }\n\n    if (!this.done() && (this.ch() === 101 || this.ch() === 69)) {\n      float = true;\n      this.pos++;\n\n      if (!this.done() && (this.ch() === 43 || this.ch() === 45)) {\n        this.pos++;\n      }\n\n      swallow([48, 49, 50, 51, 52, 53, 54, 55, 56, 57]);\n    }\n\n    const numStr = String.fromCharCode.apply(null, this.data.subarray(startPos, this.pos));\n    const num = parseFloat(numStr);\n\n    if (float) {\n      return new Token(Type.float, num, this.pos - startPos);\n    }\n\n    if (this.options.allowBigInt !== true || Number.isSafeInteger(num)) {\n      return new Token(num >= 0 ? Type.uint : Type.negint, num, this.pos - startPos);\n    }\n\n    return new Token(num >= 0 ? Type.uint : Type.negint, BigInt(numStr), this.pos - startPos);\n  }\n\n  parseString() {\n    if (this.ch() !== 34) {\n      throw new Error(`${decodeErrPrefix} unexpected character at position ${this.pos}; this shouldn't happen`);\n    }\n\n    this.pos++;\n\n    for (let i = this.pos, l = 0; i < this.data.length && l < 65536; i++, l++) {\n      const ch = this.data[i];\n\n      if (ch === 92 || ch < 32 || ch >= 128) {\n        break;\n      }\n\n      if (ch === 34) {\n        const str = String.fromCharCode.apply(null, this.data.subarray(this.pos, i));\n        this.pos = i + 1;\n        return new Token(Type.string, str, l);\n      }\n    }\n\n    const startPos = this.pos;\n    const chars = [];\n\n    const readu4 = () => {\n      if (this.pos + 4 >= this.data.length) {\n        throw new Error(`${decodeErrPrefix} unexpected end of unicode escape sequence at position ${this.pos}`);\n      }\n\n      let u4 = 0;\n\n      for (let i = 0; i < 4; i++) {\n        let ch = this.ch();\n\n        if (ch >= 48 && ch <= 57) {\n          ch -= 48;\n        } else if (ch >= 97 && ch <= 102) {\n          ch = ch - 97 + 10;\n        } else if (ch >= 65 && ch <= 70) {\n          ch = ch - 65 + 10;\n        } else {\n          throw new Error(`${decodeErrPrefix} unexpected unicode escape character at position ${this.pos}`);\n        }\n\n        u4 = u4 * 16 + ch;\n        this.pos++;\n      }\n\n      return u4;\n    };\n\n    const readUtf8Char = () => {\n      const firstByte = this.ch();\n      let codePoint = null;\n      let bytesPerSequence = firstByte > 239 ? 4 : firstByte > 223 ? 3 : firstByte > 191 ? 2 : 1;\n\n      if (this.pos + bytesPerSequence > this.data.length) {\n        throw new Error(`${decodeErrPrefix} unexpected unicode sequence at position ${this.pos}`);\n      }\n\n      let secondByte, thirdByte, fourthByte, tempCodePoint;\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 128) {\n            codePoint = firstByte;\n          }\n\n          break;\n\n        case 2:\n          secondByte = this.data[this.pos + 1];\n\n          if ((secondByte & 192) === 128) {\n            tempCodePoint = (firstByte & 31) << 6 | secondByte & 63;\n\n            if (tempCodePoint > 127) {\n              codePoint = tempCodePoint;\n            }\n          }\n\n          break;\n\n        case 3:\n          secondByte = this.data[this.pos + 1];\n          thirdByte = this.data[this.pos + 2];\n\n          if ((secondByte & 192) === 128 && (thirdByte & 192) === 128) {\n            tempCodePoint = (firstByte & 15) << 12 | (secondByte & 63) << 6 | thirdByte & 63;\n\n            if (tempCodePoint > 2047 && (tempCodePoint < 55296 || tempCodePoint > 57343)) {\n              codePoint = tempCodePoint;\n            }\n          }\n\n          break;\n\n        case 4:\n          secondByte = this.data[this.pos + 1];\n          thirdByte = this.data[this.pos + 2];\n          fourthByte = this.data[this.pos + 3];\n\n          if ((secondByte & 192) === 128 && (thirdByte & 192) === 128 && (fourthByte & 192) === 128) {\n            tempCodePoint = (firstByte & 15) << 18 | (secondByte & 63) << 12 | (thirdByte & 63) << 6 | fourthByte & 63;\n\n            if (tempCodePoint > 65535 && tempCodePoint < 1114112) {\n              codePoint = tempCodePoint;\n            }\n          }\n\n      }\n\n      if (codePoint === null) {\n        codePoint = 65533;\n        bytesPerSequence = 1;\n      } else if (codePoint > 65535) {\n        codePoint -= 65536;\n        chars.push(codePoint >>> 10 & 1023 | 55296);\n        codePoint = 56320 | codePoint & 1023;\n      }\n\n      chars.push(codePoint);\n      this.pos += bytesPerSequence;\n    };\n\n    while (!this.done()) {\n      const ch = this.ch();\n      let ch1;\n\n      switch (ch) {\n        case 92:\n          this.pos++;\n\n          if (this.done()) {\n            throw new Error(`${decodeErrPrefix} unexpected string termination at position ${this.pos}`);\n          }\n\n          ch1 = this.ch();\n          this.pos++;\n\n          switch (ch1) {\n            case 34:\n            case 39:\n            case 92:\n            case 47:\n              chars.push(ch1);\n              break;\n\n            case 98:\n              chars.push(8);\n              break;\n\n            case 116:\n              chars.push(9);\n              break;\n\n            case 110:\n              chars.push(10);\n              break;\n\n            case 102:\n              chars.push(12);\n              break;\n\n            case 114:\n              chars.push(13);\n              break;\n\n            case 117:\n              chars.push(readu4());\n              break;\n\n            default:\n              throw new Error(`${decodeErrPrefix} unexpected string escape character at position ${this.pos}`);\n          }\n\n          break;\n\n        case 34:\n          this.pos++;\n          return new Token(Type.string, decodeCodePointsArray(chars), this.pos - startPos);\n\n        default:\n          if (ch < 32) {\n            throw new Error(`${decodeErrPrefix} invalid control character at position ${this.pos}`);\n          } else if (ch < 128) {\n            chars.push(ch);\n            this.pos++;\n          } else {\n            readUtf8Char();\n          }\n\n      }\n    }\n\n    throw new Error(`${decodeErrPrefix} unexpected end of string at position ${this.pos}`);\n  }\n\n  parseValue() {\n    switch (this.ch()) {\n      case 123:\n        this.modeStack.push('obj-start');\n        this.pos++;\n        return new Token(Type.map, Infinity, 1);\n\n      case 91:\n        this.modeStack.push('array-start');\n        this.pos++;\n        return new Token(Type.array, Infinity, 1);\n\n      case 34:\n        {\n          return this.parseString();\n        }\n\n      case 110:\n        this.expect([110, 117, 108, 108]);\n        return new Token(Type.null, null, 4);\n\n      case 102:\n        this.expect([102, 97, 108, 115, 101]);\n        return new Token(Type.false, false, 5);\n\n      case 116:\n        this.expect([116, 114, 117, 101]);\n        return new Token(Type.true, true, 4);\n\n      case 45:\n      case 48:\n      case 49:\n      case 50:\n      case 51:\n      case 52:\n      case 53:\n      case 54:\n      case 55:\n      case 56:\n      case 57:\n        return this.parseNumber();\n\n      default:\n        throw new Error(`${decodeErrPrefix} unexpected character at position ${this.pos}`);\n    }\n  }\n\n  next() {\n    this.skipWhitespace();\n\n    switch (this.currentMode()) {\n      case 'value':\n        this.modeStack.pop();\n        return this.parseValue();\n\n      case 'array-value':\n        {\n          this.modeStack.pop();\n\n          if (this.ch() === 93) {\n            this.pos++;\n            this.skipWhitespace();\n            return new Token(Type.break, undefined, 1);\n          }\n\n          if (this.ch() !== 44) {\n            throw new Error(`${decodeErrPrefix} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);\n          }\n\n          this.pos++;\n          this.modeStack.push('array-value');\n          this.skipWhitespace();\n          return this.parseValue();\n        }\n\n      case 'array-start':\n        {\n          this.modeStack.pop();\n\n          if (this.ch() === 93) {\n            this.pos++;\n            this.skipWhitespace();\n            return new Token(Type.break, undefined, 1);\n          }\n\n          this.modeStack.push('array-value');\n          this.skipWhitespace();\n          return this.parseValue();\n        }\n\n      case 'obj-key':\n        if (this.ch() === 125) {\n          this.modeStack.pop();\n          this.pos++;\n          this.skipWhitespace();\n          return new Token(Type.break, undefined, 1);\n        }\n\n        if (this.ch() !== 44) {\n          throw new Error(`${decodeErrPrefix} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);\n        }\n\n        this.pos++;\n        this.skipWhitespace();\n\n      case 'obj-start':\n        {\n          this.modeStack.pop();\n\n          if (this.ch() === 125) {\n            this.pos++;\n            this.skipWhitespace();\n            return new Token(Type.break, undefined, 1);\n          }\n\n          const token = this.parseString();\n          this.skipWhitespace();\n\n          if (this.ch() !== 58) {\n            throw new Error(`${decodeErrPrefix} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);\n          }\n\n          this.pos++;\n          this.modeStack.push('obj-value');\n          return token;\n        }\n\n      case 'obj-value':\n        {\n          this.modeStack.pop();\n          this.modeStack.push('obj-key');\n          this.skipWhitespace();\n          return this.parseValue();\n        }\n\n      default:\n        throw new Error(`${decodeErrPrefix} unexpected parse state at position ${this.pos}; this shouldn't happen`);\n    }\n  }\n\n}\n\nfunction decode(data, options) {\n  options = Object.assign({\n    tokenizer: new Tokenizer(data, options)\n  }, options);\n  return _decode(data, options);\n}\n\nexport { decode, Tokenizer };","map":{"version":3,"sources":["/home/legasi/nft-marketplace/node_modules/cborg/esm/lib/json/decode.js"],"names":["decode","_decode","Token","Type","decodeCodePointsArray","decodeErrPrefix","Tokenizer","constructor","data","options","pos","modeStack","lastToken","done","length","ch","currentMode","skipWhitespace","c","expect","str","Error","i","String","fromCharCode","parseNumber","startPos","negative","float","swallow","chars","includes","uint","numStr","apply","subarray","num","parseFloat","allowBigInt","Number","isSafeInteger","negint","BigInt","parseString","l","string","readu4","u4","readUtf8Char","firstByte","codePoint","bytesPerSequence","secondByte","thirdByte","fourthByte","tempCodePoint","push","ch1","parseValue","map","Infinity","array","null","false","true","next","pop","break","undefined","token","Object","assign","tokenizer"],"mappings":"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","sourcesContent":["import { decode as _decode } from '../decode.js';\nimport {\n  Token,\n  Type\n} from '../token.js';\nimport { decodeCodePointsArray } from '../byte-utils.js';\nimport { decodeErrPrefix } from '../common.js';\nclass Tokenizer {\n  constructor(data, options = {}) {\n    this.pos = 0;\n    this.data = data;\n    this.options = options;\n    this.modeStack = ['value'];\n    this.lastToken = '';\n  }\n  done() {\n    return this.pos >= this.data.length;\n  }\n  ch() {\n    return this.data[this.pos];\n  }\n  currentMode() {\n    return this.modeStack[this.modeStack.length - 1];\n  }\n  skipWhitespace() {\n    let c = this.ch();\n    while (c === 32 || c === 9 || c === 13 || c === 10) {\n      c = this.data[++this.pos];\n    }\n  }\n  expect(str) {\n    if (this.data.length - this.pos < str.length) {\n      throw new Error(`${ decodeErrPrefix } unexpected end of input at position ${ this.pos }`);\n    }\n    for (let i = 0; i < str.length; i++) {\n      if (this.data[this.pos++] !== str[i]) {\n        throw new Error(`${ decodeErrPrefix } unexpected token at position ${ this.pos }, expected to find '${ String.fromCharCode(...str) }'`);\n      }\n    }\n  }\n  parseNumber() {\n    const startPos = this.pos;\n    let negative = false;\n    let float = false;\n    const swallow = chars => {\n      while (!this.done()) {\n        const ch = this.ch();\n        if (chars.includes(ch)) {\n          this.pos++;\n        } else {\n          break;\n        }\n      }\n    };\n    if (this.ch() === 45) {\n      negative = true;\n      this.pos++;\n    }\n    if (this.ch() === 48) {\n      this.pos++;\n      if (this.ch() === 46) {\n        this.pos++;\n        float = true;\n      } else {\n        return new Token(Type.uint, 0, this.pos - startPos);\n      }\n    }\n    swallow([\n      48,\n      49,\n      50,\n      51,\n      52,\n      53,\n      54,\n      55,\n      56,\n      57\n    ]);\n    if (negative && this.pos === startPos + 1) {\n      throw new Error(`${ decodeErrPrefix } unexpected token at position ${ this.pos }`);\n    }\n    if (!this.done() && this.ch() === 46) {\n      if (float) {\n        throw new Error(`${ decodeErrPrefix } unexpected token at position ${ this.pos }`);\n      }\n      float = true;\n      this.pos++;\n      swallow([\n        48,\n        49,\n        50,\n        51,\n        52,\n        53,\n        54,\n        55,\n        56,\n        57\n      ]);\n    }\n    if (!this.done() && (this.ch() === 101 || this.ch() === 69)) {\n      float = true;\n      this.pos++;\n      if (!this.done() && (this.ch() === 43 || this.ch() === 45)) {\n        this.pos++;\n      }\n      swallow([\n        48,\n        49,\n        50,\n        51,\n        52,\n        53,\n        54,\n        55,\n        56,\n        57\n      ]);\n    }\n    const numStr = String.fromCharCode.apply(null, this.data.subarray(startPos, this.pos));\n    const num = parseFloat(numStr);\n    if (float) {\n      return new Token(Type.float, num, this.pos - startPos);\n    }\n    if (this.options.allowBigInt !== true || Number.isSafeInteger(num)) {\n      return new Token(num >= 0 ? Type.uint : Type.negint, num, this.pos - startPos);\n    }\n    return new Token(num >= 0 ? Type.uint : Type.negint, BigInt(numStr), this.pos - startPos);\n  }\n  parseString() {\n    if (this.ch() !== 34) {\n      throw new Error(`${ decodeErrPrefix } unexpected character at position ${ this.pos }; this shouldn't happen`);\n    }\n    this.pos++;\n    for (let i = this.pos, l = 0; i < this.data.length && l < 65536; i++, l++) {\n      const ch = this.data[i];\n      if (ch === 92 || ch < 32 || ch >= 128) {\n        break;\n      }\n      if (ch === 34) {\n        const str = String.fromCharCode.apply(null, this.data.subarray(this.pos, i));\n        this.pos = i + 1;\n        return new Token(Type.string, str, l);\n      }\n    }\n    const startPos = this.pos;\n    const chars = [];\n    const readu4 = () => {\n      if (this.pos + 4 >= this.data.length) {\n        throw new Error(`${ decodeErrPrefix } unexpected end of unicode escape sequence at position ${ this.pos }`);\n      }\n      let u4 = 0;\n      for (let i = 0; i < 4; i++) {\n        let ch = this.ch();\n        if (ch >= 48 && ch <= 57) {\n          ch -= 48;\n        } else if (ch >= 97 && ch <= 102) {\n          ch = ch - 97 + 10;\n        } else if (ch >= 65 && ch <= 70) {\n          ch = ch - 65 + 10;\n        } else {\n          throw new Error(`${ decodeErrPrefix } unexpected unicode escape character at position ${ this.pos }`);\n        }\n        u4 = u4 * 16 + ch;\n        this.pos++;\n      }\n      return u4;\n    };\n    const readUtf8Char = () => {\n      const firstByte = this.ch();\n      let codePoint = null;\n      let bytesPerSequence = firstByte > 239 ? 4 : firstByte > 223 ? 3 : firstByte > 191 ? 2 : 1;\n      if (this.pos + bytesPerSequence > this.data.length) {\n        throw new Error(`${ decodeErrPrefix } unexpected unicode sequence at position ${ this.pos }`);\n      }\n      let secondByte, thirdByte, fourthByte, tempCodePoint;\n      switch (bytesPerSequence) {\n      case 1:\n        if (firstByte < 128) {\n          codePoint = firstByte;\n        }\n        break;\n      case 2:\n        secondByte = this.data[this.pos + 1];\n        if ((secondByte & 192) === 128) {\n          tempCodePoint = (firstByte & 31) << 6 | secondByte & 63;\n          if (tempCodePoint > 127) {\n            codePoint = tempCodePoint;\n          }\n        }\n        break;\n      case 3:\n        secondByte = this.data[this.pos + 1];\n        thirdByte = this.data[this.pos + 2];\n        if ((secondByte & 192) === 128 && (thirdByte & 192) === 128) {\n          tempCodePoint = (firstByte & 15) << 12 | (secondByte & 63) << 6 | thirdByte & 63;\n          if (tempCodePoint > 2047 && (tempCodePoint < 55296 || tempCodePoint > 57343)) {\n            codePoint = tempCodePoint;\n          }\n        }\n        break;\n      case 4:\n        secondByte = this.data[this.pos + 1];\n        thirdByte = this.data[this.pos + 2];\n        fourthByte = this.data[this.pos + 3];\n        if ((secondByte & 192) === 128 && (thirdByte & 192) === 128 && (fourthByte & 192) === 128) {\n          tempCodePoint = (firstByte & 15) << 18 | (secondByte & 63) << 12 | (thirdByte & 63) << 6 | fourthByte & 63;\n          if (tempCodePoint > 65535 && tempCodePoint < 1114112) {\n            codePoint = tempCodePoint;\n          }\n        }\n      }\n      if (codePoint === null) {\n        codePoint = 65533;\n        bytesPerSequence = 1;\n      } else if (codePoint > 65535) {\n        codePoint -= 65536;\n        chars.push(codePoint >>> 10 & 1023 | 55296);\n        codePoint = 56320 | codePoint & 1023;\n      }\n      chars.push(codePoint);\n      this.pos += bytesPerSequence;\n    };\n    while (!this.done()) {\n      const ch = this.ch();\n      let ch1;\n      switch (ch) {\n      case 92:\n        this.pos++;\n        if (this.done()) {\n          throw new Error(`${ decodeErrPrefix } unexpected string termination at position ${ this.pos }`);\n        }\n        ch1 = this.ch();\n        this.pos++;\n        switch (ch1) {\n        case 34:\n        case 39:\n        case 92:\n        case 47:\n          chars.push(ch1);\n          break;\n        case 98:\n          chars.push(8);\n          break;\n        case 116:\n          chars.push(9);\n          break;\n        case 110:\n          chars.push(10);\n          break;\n        case 102:\n          chars.push(12);\n          break;\n        case 114:\n          chars.push(13);\n          break;\n        case 117:\n          chars.push(readu4());\n          break;\n        default:\n          throw new Error(`${ decodeErrPrefix } unexpected string escape character at position ${ this.pos }`);\n        }\n        break;\n      case 34:\n        this.pos++;\n        return new Token(Type.string, decodeCodePointsArray(chars), this.pos - startPos);\n      default:\n        if (ch < 32) {\n          throw new Error(`${ decodeErrPrefix } invalid control character at position ${ this.pos }`);\n        } else if (ch < 128) {\n          chars.push(ch);\n          this.pos++;\n        } else {\n          readUtf8Char();\n        }\n      }\n    }\n    throw new Error(`${ decodeErrPrefix } unexpected end of string at position ${ this.pos }`);\n  }\n  parseValue() {\n    switch (this.ch()) {\n    case 123:\n      this.modeStack.push('obj-start');\n      this.pos++;\n      return new Token(Type.map, Infinity, 1);\n    case 91:\n      this.modeStack.push('array-start');\n      this.pos++;\n      return new Token(Type.array, Infinity, 1);\n    case 34: {\n        return this.parseString();\n      }\n    case 110:\n      this.expect([\n        110,\n        117,\n        108,\n        108\n      ]);\n      return new Token(Type.null, null, 4);\n    case 102:\n      this.expect([\n        102,\n        97,\n        108,\n        115,\n        101\n      ]);\n      return new Token(Type.false, false, 5);\n    case 116:\n      this.expect([\n        116,\n        114,\n        117,\n        101\n      ]);\n      return new Token(Type.true, true, 4);\n    case 45:\n    case 48:\n    case 49:\n    case 50:\n    case 51:\n    case 52:\n    case 53:\n    case 54:\n    case 55:\n    case 56:\n    case 57:\n      return this.parseNumber();\n    default:\n      throw new Error(`${ decodeErrPrefix } unexpected character at position ${ this.pos }`);\n    }\n  }\n  next() {\n    this.skipWhitespace();\n    switch (this.currentMode()) {\n    case 'value':\n      this.modeStack.pop();\n      return this.parseValue();\n    case 'array-value': {\n        this.modeStack.pop();\n        if (this.ch() === 93) {\n          this.pos++;\n          this.skipWhitespace();\n          return new Token(Type.break, undefined, 1);\n        }\n        if (this.ch() !== 44) {\n          throw new Error(`${ decodeErrPrefix } unexpected character at position ${ this.pos }, was expecting array delimiter but found '${ String.fromCharCode(this.ch()) }'`);\n        }\n        this.pos++;\n        this.modeStack.push('array-value');\n        this.skipWhitespace();\n        return this.parseValue();\n      }\n    case 'array-start': {\n        this.modeStack.pop();\n        if (this.ch() === 93) {\n          this.pos++;\n          this.skipWhitespace();\n          return new Token(Type.break, undefined, 1);\n        }\n        this.modeStack.push('array-value');\n        this.skipWhitespace();\n        return this.parseValue();\n      }\n    case 'obj-key':\n      if (this.ch() === 125) {\n        this.modeStack.pop();\n        this.pos++;\n        this.skipWhitespace();\n        return new Token(Type.break, undefined, 1);\n      }\n      if (this.ch() !== 44) {\n        throw new Error(`${ decodeErrPrefix } unexpected character at position ${ this.pos }, was expecting object delimiter but found '${ String.fromCharCode(this.ch()) }'`);\n      }\n      this.pos++;\n      this.skipWhitespace();\n    case 'obj-start': {\n        this.modeStack.pop();\n        if (this.ch() === 125) {\n          this.pos++;\n          this.skipWhitespace();\n          return new Token(Type.break, undefined, 1);\n        }\n        const token = this.parseString();\n        this.skipWhitespace();\n        if (this.ch() !== 58) {\n          throw new Error(`${ decodeErrPrefix } unexpected character at position ${ this.pos }, was expecting key/value delimiter ':' but found '${ String.fromCharCode(this.ch()) }'`);\n        }\n        this.pos++;\n        this.modeStack.push('obj-value');\n        return token;\n      }\n    case 'obj-value': {\n        this.modeStack.pop();\n        this.modeStack.push('obj-key');\n        this.skipWhitespace();\n        return this.parseValue();\n      }\n    default:\n      throw new Error(`${ decodeErrPrefix } unexpected parse state at position ${ this.pos }; this shouldn't happen`);\n    }\n  }\n}\nfunction decode(data, options) {\n  options = Object.assign({ tokenizer: new Tokenizer(data, options) }, options);\n  return _decode(data, options);\n}\nexport {\n  decode,\n  Tokenizer\n};"]},"metadata":{},"sourceType":"module"}